@{
    Layout = "_AdminLayout";
    ViewData["Title"] = "Admin Dashboard";
}
@model DashboardViewModel

<div class="flex flex-col gap-y-6">

    <div class="container">
        <div class="row">
            <h1 class="text-2xl font-bold tracking-tight">Gösterge Paneli</h1>
        </div>
    </div>

    <div class="container">
        <div class="row g-3">
            <div class="col-6 col-md-4">
                <div class="card shadow-sm border-0 h-100 bg-white rounded-4">
                    <div class="card-body py-4">
                        <h6 class="card-title fw-semibold text-muted small text-uppercase">Toplam İlanlar</h6>
                        <p class="card-text fs-2 fw-bold mb-0 text-dark">@Model.TotalProperties</p>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-4">
                <div class="card shadow-sm border-0 h-100 bg-white rounded-4">
                    <div class="card-body py-4">
                        <h6 class="card-title fw-semibold text-muted small text-uppercase">Aktif İlanlar</h6>
                        <p class="card-text fs-2 fw-bold mb-0 text-success">@Model.ActiveProperties</p>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-4">
                <div class="card shadow-sm border-0 h-100 bg-white rounded-4">
                    <div class="card-body py-4">
                        <h6 class="card-title fw-semibold text-muted small text-uppercase">Toplam Kullanıcılar</h6>
                        <p class="card-text fs-2 fw-bold mb-0 text-primary">@Model.TotalUsers</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="card shadow-sm border-0 rounded-4 overflow-hidden">
            <div class="card-header bg-white border-0 py-3">
                <h5 class="card-title mb-0 fw-bold text-dark d-flex align-items-center">
                    <span class="p-2 bg-primary-subtle rounded-circle me-2">
                        <i class="bi bi-activity text-primary"></i>
                    </span>
                    Yapılan İşlemler (Canlı)
                </h5>
            </div>
            <div class="card-body p-0">
                <ul class="list-group list-group-flush" id="activityLog">
                    <li class="list-group-item text-center py-4 text-muted border-0" id="noActivity">
                        <i class="bi bi-info-circle me-2"></i>Henüz yeni bir işlem yapılmadı.
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container mb-4">
        <div class="card shadow-sm p-4 border-0 rounded-4">
            <h5 class="card-title mb-4 fw-bold text-dark">Hızlı İşlemler</h5>
            <div class="row g-3">
                <div class="col-6 col-md-3">
                    <a asp-controller="Admin" asp-action="AddProperty"
                       class="d-flex flex-column align-items-center justify-content-center p-4 rounded-4 bg-primary text-white text-decoration-none transition-all hover-scale">
                        <div class="bg-white/20 p-3 rounded-circle mb-3">
                            <i class="bi bi-house-add fs-3"></i>
                        </div>
                        <h6 class="fw-semibold mb-1">İlan Ekle</h6>
                    </a>
                </div>
                <div class="col-6 col-md-3">
                    <a asp-controller="Admin" asp-action="AddCategory"
                       class="d-flex flex-column align-items-center justify-content-center p-4 rounded-4 bg-success text-white text-decoration-none transition-all hover-scale">
                        <div class="bg-white/20 p-3 rounded-circle mb-3">
                            <i class="bi bi-tag fs-3"></i>
                        </div>
                        <h6 class="fw-semibold mb-1">Kategori Ekle</h6>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .hover-scale {
        transition: transform 0.2s ease;
    }

        .hover-scale:hover {
            transform: translateY(-5px);
        }

    /* --- Animasyon Stilleri --- */
    .activity-item {
        transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 0;
        transform: translateY(-20px);
        background-color: #f0f7ff;
    }

        /* Giriş Animasyonu (Fade-In) */
        .activity-item.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Çıkış Animasyonu (Fade-Out ve Daralma) */
        .activity-item.fade-out {
            opacity: 0;
            transform: scale(0.9) translateY(10px);
            margin-top: -55px; /* Eleman silinirken alttakilerin kayması için */
            z-index: -1;
        }
</style>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.min.js"></script>
    <script>
        var connection = new signalR.HubConnectionBuilder()
            .withUrl("/general-hub")
            .build();

        connection.on("ReceiveAdminNotification", function (message) {
            const activityLog = document.getElementById("activityLog");
            const noActivity = document.getElementById("noActivity");

            // 1. "Henüz işlem yok" yazısını gizle
            if (noActivity) {
                noActivity.style.display = 'none';
            }

            // 2. Yeni liste elemanı oluştur
            const li = document.createElement("li");
            li.className = "list-group-item d-flex justify-content-between align-items-center py-3 activity-item border-start border-primary border-4";

            const now = new Date();
            const timeStr = now.getHours() + ":" + (now.getMinutes() < 10 ? '0' : '') + now.getMinutes();

            li.innerHTML = `
                <div class="d-flex align-items-center">
                    <div class="bg-primary rounded-circle p-2 me-3" style="width: 10px; height: 10px;"></div>
                    <span class="fw-bold text-dark">${message}</span>
                </div>
                <small class="text-muted fw-medium">${timeStr}</small>
            `;

            // 3. Listenin başına ekle
            activityLog.insertBefore(li, activityLog.firstChild);

            // 4. Fade-In Başlat
            setTimeout(() => {
                li.classList.add('show');
            }, 50);

            // 5. 2 Saniye Bekle ve Fade-Out Yaparak Kaldır
            setTimeout(() => {
                li.classList.add('fade-out');

                // Görsel animasyon tamamlanınca DOM'dan temizle
                setTimeout(() => {
                    li.remove();

                    // Eğer listede hiç eleman kalmadıysa "Henüz işlem yok"u geri getir
                    if (activityLog.children.length === 0 ||
                       (activityLog.children.length === 1 && activityLog.children[0].id === "noActivity")) {
                        if (noActivity) noActivity.style.display = 'block';
                    }
                }, 600); // CSS transition süresi ile uyumlu

            }, 2000); // Ekranda kalma süresi
        });

        connection.start().catch(err => console.error(err.toString()));
    </script>
}